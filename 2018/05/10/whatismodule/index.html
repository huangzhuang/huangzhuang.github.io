<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>模块的导来导去 | hzhuang的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前记概述几种之前的模块加载方案：CommonJS（服务器）和AMD（浏览器）。ES6的模块加载规范可以完全取代上两者，成为浏览器和服务器通用的模块解决方案。知己知彼，方能百战不殆。先来看看之前的两种加载方式。
1.CommonJsCommonJs规范
概述
每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。

123//test.js 这个文件">
<meta property="og:type" content="article">
<meta property="og:title" content="模块的导来导去">
<meta property="og:url" content="http://huangzhuang.github.io/2018/05/10/whatismodule/index.html">
<meta property="og:site_name" content="hzhuang的博客">
<meta property="og:description" content="前记概述几种之前的模块加载方案：CommonJS（服务器）和AMD（浏览器）。ES6的模块加载规范可以完全取代上两者，成为浏览器和服务器通用的模块解决方案。知己知彼，方能百战不殆。先来看看之前的两种加载方式。
1.CommonJsCommonJs规范
概述
每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。

123//test.js 这个文件">
<meta property="og:image" content="http://yanxuan.nosdn.127.net/b84467def981644ba3981e9da538a476.png">
<meta property="og:image" content="http://yanxuan.nosdn.127.net/d32042dcba612a25c84f69399aaaf6c4.png">
<meta property="og:image" content="http://yanxuan.nosdn.127.net/c3c5a2ca1aa5600cea6ca52f49cf32f6.png">
<meta property="og:updated_time" content="2018-05-10T06:20:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="模块的导来导去">
<meta name="twitter:description" content="前记概述几种之前的模块加载方案：CommonJS（服务器）和AMD（浏览器）。ES6的模块加载规范可以完全取代上两者，成为浏览器和服务器通用的模块解决方案。知己知彼，方能百战不殆。先来看看之前的两种加载方式。
1.CommonJsCommonJs规范
概述
每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。

123//test.js 这个文件">
  
  
    <link rel="icon" href="http://hz2015.sinaapp.com/static/images/zhuang.jpg">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b20a205ed88943a2e3b262a3e51a21e5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://hz2015.sinaapp.com/static/images/zhuang.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">hzhuang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">人若无名，便可专心练剑！</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/categories/web">web</a></li>
				        
							<li><a href="/categories/bootstrap">bootstrap</a></li>
				        
							<li><a href="/categories/jquery">jquery源码</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/huangzhuang" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/1875236755/profile?topnav=1&wvr=6" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/huang-zhuang-225" title="zhihu">zhihu</a>
					        
								<a class="jianshu" target="_blank" href="http://www.jianshu.com/users/b3a8f42682b2/latest_articles" title="jianshu">jianshu</a>
					        
								<a class="mail" target="_blank" href="mailto:hzhuang_wnlo@126.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/MVC/" style="font-size: 10px;">MVC</a> <a href="/tags/animation/" style="font-size: 10px;">animation</a> <a href="/tags/autosize/" style="font-size: 10px;">autosize</a> <a href="/tags/bootstrap/" style="font-size: 10px;">bootstrap</a> <a href="/tags/commonJS/" style="font-size: 10px;">commonJS</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/css3/" style="font-size: 17.5px;">css3</a> <a href="/tags/debug/" style="font-size: 10px;">debug</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/iscroll/" style="font-size: 10px;">iscroll</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/js/" style="font-size: 20px;">js</a> <a href="/tags/js-sdk/" style="font-size: 10px;">js-sdk</a> <a href="/tags/learning/" style="font-size: 15px;">learning</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/ng4/" style="font-size: 10px;">ng4</a> <a href="/tags/reqexp/" style="font-size: 10px;">reqexp</a> <a href="/tags/sublimeText/" style="font-size: 10px;">sublimeText</a> <a href="/tags/transition/" style="font-size: 10px;">transition</a> <a href="/tags/webview/" style="font-size: 10px;">webview</a> <a href="/tags/代码规范/" style="font-size: 12.5px;">代码规范</a> <a href="/tags/前端/" style="font-size: 20px;">前端</a> <a href="/tags/前端框架/" style="font-size: 12.5px;">前端框架</a> <a href="/tags/学习笔记/" style="font-size: 10px;">学习笔记</a> <a href="/tags/录音/" style="font-size: 10px;">录音</a> <a href="/tags/微信/" style="font-size: 10px;">微信</a> <a href="/tags/构建工具/" style="font-size: 10px;">构建工具</a> <a href="/tags/模仿qq/" style="font-size: 10px;">模仿qq</a> <a href="/tags/源码/" style="font-size: 12.5px;">源码</a> <a href="/tags/笔记/" style="font-size: 10px;">笔记</a> <a href="/tags/简书/" style="font-size: 10px;">简书</a> <a href="/tags/系列/" style="font-size: 12.5px;">系列</a> <a href="/tags/编辑器/" style="font-size: 10px;">编辑器</a> <a href="/tags/自动化/" style="font-size: 10px;">自动化</a> <a href="/tags/选择器/" style="font-size: 10px;">选择器</a> <a href="/tags/高级程序/" style="font-size: 10px;">高级程序</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">华中科技大学13级硕士，研三在读。准易中人，现在正在全力提升中。。。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">hzhuang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://hz2015.sinaapp.com/static/images/zhuang.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">hzhuang</h1>
			</hgroup>
			
			<p class="header-subtitle">人若无名，便可专心练剑！</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/categories/web">web</a></li>
		        
					<li><a href="/categories/bootstrap">bootstrap</a></li>
		        
					<li><a href="/categories/jquery">jquery源码</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/huangzhuang" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/1875236755/profile?topnav=1&wvr=6" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/huang-zhuang-225" title="zhihu">zhihu</a>
			        
						<a class="jianshu" target="_blank" href="http://www.jianshu.com/users/b3a8f42682b2/latest_articles" title="jianshu">jianshu</a>
			        
						<a class="mail" target="_blank" href="mailto:hzhuang_wnlo@126.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
<article id="post-whatismodule" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/05/10/whatismodule/" class="article-date">
  	<time datetime="2018-05-10T06:15:00.000Z" itemprop="datePublished">2018-05-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      模块的导来导去
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/commonJS/">commonJS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/es6/">es6</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
<a href="https://unsplash.it/1568/500/?random" title="" rel="fancy-group" class="fancy-ctn fancybox"><img src="https://unsplash.it/1568/500/?random" title=""></a>

      <div class="entry">
      
        <div id="toc" class="toc-article">
    <strong class="toc-title">目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前记"><span class="toc-text">前记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#概述"><span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-CommonJs"><span class="toc-text">1.CommonJs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概述-1"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#module对象"><span class="toc-text">module对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AMD规范和CommonJS规范的兼容性"><span class="toc-text">AMD规范和CommonJS规范的兼容性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#require命令"><span class="toc-text">require命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#模块的加载机制"><span class="toc-text">模块的加载机制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-AMD规范（异步模块定义）"><span class="toc-text">2.AMD规范（异步模块定义）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-CMD规范"><span class="toc-text">3.CMD规范</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Module"><span class="toc-text">Module</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#严格模式"><span class="toc-text">严格模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#export_命令"><span class="toc-text">export 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#import_命令"><span class="toc-text">import 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模块的整体加载"><span class="toc-text">模块的整体加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#export_default命令"><span class="toc-text">export default命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#export_和_import_的复合写法"><span class="toc-text">export 和 import 的复合写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模块的继承"><span class="toc-text">模块的继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨模块变量"><span class="toc-text">跨模块变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#import()_一个提案"><span class="toc-text">import()  一个提案</span></a></li></ol></li></ol>
</div>

      
        <h1 id="前记">前记</h1><h2 id="概述">概述</h2><p>几种之前的模块加载方案：CommonJS（服务器）和AMD（浏览器）。<br>ES6的模块加载规范可以完全取代上两者，成为浏览器和服务器通用的<strong>模块解决方案</strong>。<br>知己知彼，方能百战不殆。先来看看之前的两种加载方式。</p>
<h3 id="1-CommonJs">1.CommonJs</h3><p><a href="http://javascript.ruanyifeng.com/nodejs/module.html" target="_blank" rel="external">CommonJs规范</a></p>
<h4 id="概述-1">概述</h4><blockquote>
<p>每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。</p>
</blockquote>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test.js 这个文件就是一个module</span></span><br><span class="line"><span class="keyword">var</span> myName = <span class="string">'hzhuang'</span>;</span><br><span class="line"><span class="keyword">var</span> mySex = <span class="string">'boy'</span>;</span><br></pre></td></tr></table></figure>
<p>在模块内部的话，module这个变量是存在的，表示当前的模块。想将myNamemySex这两个变量共享到其它模块的话，则除了设置window对象上的属性外（不推荐），可以将它们用<code>module.exports</code>（对外接口）方法输出出去。然后在其它模块中｀require(filePath)`引入到其它的模块中。</p>
<a id="more"></a>
<p><img src="http://yanxuan.nosdn.127.net/b84467def981644ba3981e9da538a476.png" alt=""></p>
<h4 id="module对象">module对象</h4><p>模块内部都有一个module对象，代表当前的模块。<br><img src="http://yanxuan.nosdn.127.net/d32042dcba612a25c84f69399aaaf6c4.png" alt=""></p>
<p><strong>exports变量</strong><br>内置的一个对象，等价<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="keyword">exports</span> = module.<span class="keyword">exports</span>;</span><br></pre></td></tr></table></figure></p>
<p>三点：</p>
<ul>
<li>module.exports初始值是一个空对象{}。</li>
<li>exports是指向module.exports的引用。</li>
<li>require()返回的是module.exports而不是exports。</li>
</ul>
<p>可以在这个对象中增加属性或者方法，但是不可以直接赋值。<br>注：如果在文件中对module.exports操作了的话，exports对象失效，所以如果模块输出一个函数，应定义在module.exports上，而不是在exports对象上。</p>
<p>关于module.exports与exports的差别，知道以上三点就可以了。</p>
<h4 id="AMD规范和CommonJS规范的兼容性">AMD规范和CommonJS规范的兼容性</h4><p>CommonJS规范 －－－－－－－ 同步加载。<br>AMD规范 －－－－－－－－－－ 非同步加载。</p>
<h4 id="require命令">require命令</h4><p>CommonJS的内置命令，用于加载模块文件，读入并<strong>执行</strong>一个js文件。</p>
<p>文件加载规则：<br>后缀名默认是<code>.js</code>。</p>
<table>
<thead>
<tr>
<th>规则</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/</code></td>
<td>绝对路径查找模块</td>
</tr>
<tr>
<td><code>./</code></td>
<td>相对路径查找模块</td>
</tr>
<tr>
<td>非以上两种</td>
<td>加载默认提供的核心模块（node自带／安装的模块）</td>
</tr>
<tr>
<td>非前两种的路径</td>
<td>则先按加载默认提供的核心模块加载到模块，然后根据路径查找到指定的模块</td>
</tr>
<tr>
<td>未查找到的情况下</td>
<td>添加<code>.js</code>,<code>.json</code>,<code>.node</code>文件后缀后继续查找。</td>
</tr>
</tbody>
</table>
<p>目录加载规则：<br>可以解释为什么在平时的项目中，可以省略<code>index.js</code>的写法。</p>
<blockquote>
<p>require发现参数字符串指向一个目录以后，会自动查看该目录的package.json文件，然后加载main字段指定的入口文件。如果package.json文件没有main字段，或者根本就没有package.json文件，则会加载该目录下的index.js文件或index.node文件。</p>
</blockquote>
<p>也就是，可以在文件夹中增加package.json的main字段中指定入口文件。我们的项目中用的是直接取名index.js(x)的方式取的默认。</p>
<p>模块的缓存：<br>第一次加载模块时，会将这个加载的模块缓存起来。</p>
<p>所有的缓存保存在require.cache的对象中。想删除的话可以使用<code>delete</code>的方法删除对象中的某个属性。</p>
<p>模块的循环加载：<br>A加载B，B加载A的话，现有的理解是，在B中只加载A的require(B)的之前的部分。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//testA/index.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'a.js'</span>, <span class="built_in">require</span>(<span class="string">'../testB'</span>).x);</span><br><span class="line">exports.x = <span class="string">'A1'</span>;</span><br><span class="line">exports.x = <span class="string">'A2'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//testB/index.js</span></span><br><span class="line">exports.x = <span class="string">'B1'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'b.js'</span>, <span class="built_in">require</span>(<span class="string">'../testA'</span>).x);</span><br><span class="line">exports.x = <span class="string">'B2'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'main.js '</span>, <span class="built_in">require</span>(<span class="string">'./testA'</span>).x);</span><br><span class="line"></span><br><span class="line"><span class="comment">//结果</span></span><br><span class="line">b.js <span class="literal">undefined</span></span><br><span class="line">a.js B2</span><br><span class="line">main.js  A2</span><br></pre></td></tr></table></figure>
<p>可见，在B中只加载A的require(B)的之前的部分得证。</p>
<p>require.main属性：<br>用来判断模块是直接执行还是调用执行。</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = require.main === moduleName ? '直接执行' : '调用执行';</span><br></pre></td></tr></table></figure>
<h4 id="模块的加载机制">模块的加载机制</h4><blockquote>
<p>输入的是被输出的值的拷贝。</p>
</blockquote>
<p>模块中的值一旦被导出的话，就不受模块内部变量值的变化而变化了。</p>
<p>require的内部处理流程：</p>
<p>require是一个指向当前模块的module.require命令。<br>module.require调用Module._load。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Module._load = <span class="function"><span class="keyword">function</span><span class="params">(request, parent, isMain)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//步骤:</span></span><br><span class="line">    <span class="comment">//1. 检查Module._cache</span></span><br><span class="line">    <span class="comment">//2. 第一次加载，没缓存过， 则创建新的Module实例，并将之保存到缓存中</span></span><br><span class="line">    <span class="comment">//3. 使用module.load()加载指定的模块文件，读取文件内容之后使用module.compile()执行文件代码。</span></span><br><span class="line">    <span class="comment">//4. 如果加载/解析过程报错，就从缓存删除该模块。</span></span><br><span class="line">    <span class="comment">//5. 返回该模块的 module.exports。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可见，module.load方法用于加载模块，module.compile方法用来解析模块，也就是执行指定模块的脚本。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Module.prototype._compile = <span class="function"><span class="keyword">function</span><span class="params">(content, filename)</span></span> &#123;</span><br><span class="line">  // <span class="number">1.</span> 生成一个<span class="built_in">require</span>函数，指向<span class="built_in">module</span>.<span class="built_in">require</span>。</span><br><span class="line">  // <span class="number">2.</span> 加载其他辅助方法到<span class="built_in">require</span>。</span><br><span class="line">  // <span class="number">3.</span> 将文件内容放到一个函数之中，该函数可调用 <span class="built_in">require</span>。</span><br><span class="line">  // <span class="number">4.</span> 执行该函数</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>require函数准备ok后，整个所有加载的脚本内容就被放在了一个新的函数之中了，这样避免污染全局变量。</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">(<span class="keyword">function</span> <span class="list">(<span class="keyword">exports</span>, require, module, __filename, __dirname)</span> <span class="collection">&#123;</span><br><span class="line">  // 模块的代码。</span><br><span class="line">&#125;</span>)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>详见下文：<br><a href="http://fredkschott.com/post/2014/06/require-and-the-module-system/" target="_blank" rel="external">The Node.js Way - How <code>require()</code> Actually Works</a></p>
<p>下图是项目中经过webpack打包后的某个文件的部分。<br><img src="http://yanxuan.nosdn.127.net/c3c5a2ca1aa5600cea6ca52f49cf32f6.png" alt=""></p>
<h3 id="2-AMD规范（异步模块定义）">2.AMD规范（异步模块定义）</h3><p>简单的了解的一下。<br>这个规范主要是用在浏览器。</p>
<p>也采用require()语句加载模块，但是要求两个参数。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span>([<span class="class"><span class="keyword">module</span>], <span class="title">callbacl</span>);</span></span><br><span class="line">/<span class="regexp">/第一个参数是一个数组，表示需要加载的模块。</span><br><span class="line">/</span><span class="regexp">/第二个参数是加载成功之后的回调函数。</span></span><br></pre></td></tr></table></figure>
<p>这个规范，最常用的是<code>require.js</code>库。</p>
<p>模块定义：<code>define</code><br>模块必须采用特定的 define() 函数来定义。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//moduleName = test   test.js</span></span><br><span class="line"><span class="comment">//无依赖</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span><span class="params">(x,y)</span></span>&#123; <span class="keyword">return</span> x + y;&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        add: add</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//有依赖</span></span><br><span class="line">define([<span class="string">'dependModule'</span>], <span class="function"><span class="keyword">function</span><span class="params">(dependModule)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span><span class="params">(x,y)</span></span>&#123; <span class="keyword">return</span> x + y;&#125;;</span><br><span class="line">    <span class="comment">//do something else</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        add: add</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>加载：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reuqire([<span class="string">'test'</span>], <span class="function"><span class="keyword">function</span><span class="params">(test)</span></span>&#123;</span><br><span class="line">    <span class="comment">//do something</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="3-CMD规范">3.CMD规范</h3><p>代表人物<code>seaJs</code>。<br>一个模块就是一个文件。define 是一个全局函数，用来定义模块。</p>
<p>define全局函数接受一个factory参数。</p>
<p>factory参数是对象/字符串：<br>表示模块的接口就是该对象/字符串</p>
<p>factory参数是函数时，接受三个参数：require、exports和module。</p>
<ul>
<li>require 是一个方法，接受模块标识作为唯一参数，用来获取其他模块提供的接口：require(id)</li>
<li>exports 是一个对象，用来向外提供模块接口。</li>
<li>module 是一个对象，上面存储了与当前模块相关联的一些属性和方法。</li>
</ul>
<p>好了，这几种规范有了一个初步的了解后，再回来继续学习导来导去。</p>
<p>ES6的模块的设计思想是<code>尽量的静态化</code>，使得编译的时候就能确定模块的依赖关系，以及输入和输出的变量。<br>相比而言，CommonJs只能是在运行时才能确定依赖关系。</p>
<p>先看看CommonJS和ES6-module的差别：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*CommonJS*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;A, B, C&#125;  = <span class="built_in">require</span>(<span class="string">'Test'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//分解来看是：</span></span><br><span class="line"><span class="keyword">let</span> _Test = <span class="built_in">require</span>(<span class="string">'Test'</span>); <span class="comment">//Test模块先全部加载。</span></span><br><span class="line"><span class="keyword">let</span> A = _Test.A;</span><br><span class="line"><span class="keyword">let</span> B = _Test.B;</span><br><span class="line"><span class="keyword">let</span> C = _Test.C;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可见需要先将Test整个模块先加载出来。**运行时加载**</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*ES6-module*/</span></span><br><span class="line"><span class="keyword">import</span> &#123;A, B, C&#125; <span class="keyword">from</span> <span class="string">'Test'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可见，es6的模块，直接是从模块中取所需即可。**编译时加载/静态加载**</span></span><br></pre></td></tr></table></figure>
<p>ES6-module这么酷，那就来系统的看看吧。</p>
<h1 id="Module">Module</h1><h2 id="严格模式">严格模式</h2><p>ES6-module默认采用严格模式。</p>
<p>严格模式限制：</p>
<ul>
<li>变量必须声明后再使用</li>
<li>函数的参数不能有同名属性，否则报错</li>
<li>不能使用with语句</li>
<li>不能对只读属性赋值，否则报错</li>
<li>不能使用前缀 0 表示八进制数，否则报错</li>
<li>不能删除不可删除的属性，否则报错</li>
<li>不能删除变量delete prop，会报错，只能删除属性delete global[prop]</li>
<li>eval不会在它的外层作用域引入变量</li>
<li>eval和arguments不能被重新赋值</li>
<li>arguments不会自动反映函数参数的变化</li>
<li>不能使用arguments.callee</li>
<li>不能使用arguments.caller</li>
<li>禁止this指向全局对象</li>
<li>不能使用fn.caller和fn.arguments获取函数调用的堆栈</li>
<li>增加了保留字（比如protected、static和interface）</li>
</ul>
<p>好多不知道啊，这个需要一篇专文来扯扯什么是严格模式。<br>占个位！！！！！！！</p>
<h2 id="export_命令">export 命令</h2><p>规定模块的对外接口。</p>
<p>一个文件就是一个模块。文件内部的变量只能用<code>export</code>导出去。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//等价</span></span><br><span class="line"><span class="keyword">var</span> a  = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">x,y</span>)</span>&#123;<span class="keyword">return</span> x+y;&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123;a, b, fn&#125;;</span><br></pre></td></tr></table></figure>
<p><code>as</code>这是一个关键词，可以指定导出变量的别名。</p>
<blockquote>
<p>export命令规定的是对外的接口，必须与模块内部的变量建立一一对应关系</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="number">1</span>; <span class="comment">//非法。</span></span><br><span class="line"></span><br><span class="line">var m = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> m; <span class="comment">//也是非法的。</span></span><br></pre></td></tr></table></figure>
<p>export导出的接口和模块内部的值是动态绑定的，通过接口可以取到模块内部实时的值。</p>
<blockquote>
<p>export命令可以出现在模块的任何位置，只要处于模块顶层就可以</p>
</blockquote>
<h2 id="import_命令">import 命令</h2><p>通过import命令来加载模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;A , B , C&#125; <span class="keyword">from</span> <span class="string">'xxx/someModule'</span>;</span><br></pre></td></tr></table></figure>
<p>以上，大括号内的ABC必须是someModule中导出的接口名称。<br>同样，如果想换一个名字，那就用<code>as</code>命令。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;D <span class="keyword">as</span> A , B , C&#125; <span class="keyword">from</span> <span class="string">'xxx/someModule'</span>;</span><br></pre></td></tr></table></figure>
<p>import导入的是<code>read-only</code>的，所以不能直接修改导入的变量，但是可以修改它的属性值。</p>
<p>from是指定模块文件的位置，可以是相对路径或者绝对路径，<code>.js</code>后缀名可以省略。也可以直接取模块名（配置好的）。</p>
<p>另，import会得到提升，提升到整个模块的前面，优先之行。所以，下面的写法是合理的。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D(); </span><br><span class="line"><span class="keyword">import</span> &#123;D <span class="keyword">as</span> A , B , C&#125; <span class="keyword">from</span> <span class="string">'xxx/someModule'</span>;</span><br></pre></td></tr></table></figure></p>
<p>import是静态加载，所以在有关加载时，需要运行的写法都是不合法的。比如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="string">'a'</span> + <span class="string">'b'</span>&#125; <span class="keyword">from</span> <span class="string">'someModule'</span>; <span class="comment">// error</span></span><br><span class="line"><span class="keyword">if</span>( a &gt; <span class="number">1</span>) <span class="keyword">import</span> &#123;<span class="string">'ab'</span>&#125; <span class="keyword">from</span> <span class="string">'someModule'</span>; <span class="comment">//error</span></span><br><span class="line"><span class="keyword">var</span> some = <span class="string">'someModule'</span>; <span class="keyword">import</span> &#123;<span class="string">'ab'</span>&#125; <span class="keyword">from</span> some; <span class="comment">//error</span></span><br></pre></td></tr></table></figure></p>
<p>以上说的是从模块中导出接口变量，如果本身模块就是一个函数，则该如何调用呢？直接<code>import + moduleName</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只会之行一次的。</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'lodash'</span>; <span class="comment">//执行所加载的模块。</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'lodash'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'lodash'</span>;</span><br></pre></td></tr></table></figure>
<p>CommonJS和ES6-moule是可以写在一个模块中的，但是需要注意import的提升。</p>
<h2 id="模块的整体加载">模块的整体加载</h2><p>某个模块有很多接口，我导入的时候要一个一个的写在大括号里，实在是太麻烦了，所以有整体加载的方式，即<code>*</code>，<br>注！！！！！！这种方法会忽略default的接口。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> name <span class="keyword">from</span> <span class="string">'someModule'</span>;</span><br><span class="line">name.A;</span><br><span class="line">name.B;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">name.Z;</span><br></pre></td></tr></table></figure>
<h2 id="export_default命令">export default命令</h2><p>为模块指定默认输出。</p>
<p>导入默认的变量是不需要大括号的，否则是需要的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'test-1111'</span>);&#125;</span><br></pre></td></tr></table></figure>
<p>然后在其他模块中的时候，可以指定任意名字来关联这个默认的输出。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xiawan <span class="keyword">from</span> <span class="string">'module'</span>;</span><br><span class="line">xiawan();</span><br><span class="line"><span class="comment">//输出：test-1111</span></span><br></pre></td></tr></table></figure></p>
<p>export default就好像是约定了一个叫default的变量，所以后面不能再接变量声明语句。</p>
<h2 id="export_和_import_的复合写法">export 和 import 的复合写法</h2><p>在一个模块内，先导入，然后再导出用一个模块。可以这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;A , B , C&#125; <span class="keyword">from</span> <span class="string">'someModule'</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;A, B, C&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这种写法可以复合成一句：<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;A, B, C&#125; <span class="keyword">from</span> <span class="string">'someModule'</span>;</span><br></pre></td></tr></table></figure></p>
<p>注：</p>
<ul>
<li>当前模块并没有导入此模块，只是做了一个转发。</li>
<li>在当前模块中是不可以使用导入模块的接口的。</li>
</ul>
<p>可以实现模块接口的改名再整理输出<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口改名</span></span><br><span class="line">export &#123;A <span class="keyword">as</span> D&#125; <span class="keyword">from</span> <span class="string">'someModule'</span>;</span><br><span class="line"><span class="comment">//整体输出</span></span><br><span class="line">export * <span class="keyword">from</span> <span class="string">'someModule'</span>;</span><br><span class="line"><span class="comment">//默认接口</span></span><br><span class="line">export &#123;<span class="keyword">default</span>&#125; <span class="keyword">from</span> <span class="string">'someModule'</span>;</span><br><span class="line"><span class="comment">//接口改为默认接口</span></span><br><span class="line">export &#123;A <span class="keyword">as</span> <span class="keyword">default</span>&#125; <span class="keyword">from</span> <span class="string">'someModule'</span>;</span><br><span class="line"><span class="comment">//默认接口改名</span></span><br><span class="line">export &#123;<span class="keyword">default</span> <span class="keyword">as</span> A&#125; <span class="keyword">from</span> <span class="string">'someModule'</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="模块的继承">模块的继承</h2><p>模块之间是可以继承的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> * from <span class="string">'someModule'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> test = <span class="number">1111</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">console</span>.log(<span class="string">'default'</span>);&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="跨模块变量">跨模块变量</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> A = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h2 id="import()_一个提案">import()  一个提案</h2><p>前面提到es6-module是静态加载的，如果放在运行的代码中的话会报错。<br>import()用来完成动态加载。</p>
<p>关于import()：</p>
<ul>
<li>返回一个promise</li>
<li>可以用在任何地方。</li>
<li>与所加载的模块咩有静态链接关系。</li>
<li>类似require，但是是异步加载。</li>
</ul>
<p>适用场景：</p>
<ul>
<li>按需加载</li>
<li>条件加载</li>
<li>动态的模块路径</li>
</ul>

      
    </div>

    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2018/04/25/angular4/deepStudyNg4/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">认真玩玩angular4</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="whatismodule" data-title="模块的导来导去" data-url="http://huangzhuang.github.io/2018/05/10/whatismodule/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 hzhuang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<script src="/js/totop.js"></script>

  </div>
</body>
</html>